<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>sportdb</title>
    <link rel="icon" type="image/pn" href="images/sportify_logo.png">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/estilo.css">
	<!-- Librerías de Bootstrap y jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</head>

<script>

	document.addEventListener("DOMContentLoaded", function() {
		var idUsuario = getCookie("idUsuario");
		if (!idUsuario) {
			window.location.href = 'index.html'; // Redirige a la página de inicio de sesión si no hay cookie
		}else{
            mostrarInfoEquipo();
            obtenerDatosUsuario(idUsuario);

        }
	});

    function obtenerDatosUsuario(idUsuario) {
        fetch('php/obtenerDatosUsuario.php?idUsuario=' + idUsuario)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    var usuario = data.usuario;
                    document.getElementById("userId").textContent = usuario.id_usuario;
                    document.getElementById("userName").textContent = usuario.usuario;
                    document.getElementById("userLevel").textContent = usuario.nivel;
                    document.getElementById("userTeam").textContent = usuario.preferencia_equipo;
                } else {
                    console.error(data.message);
                }
            })
            .catch(error => {
                console.error('Error al obtener datos de usuario:', error);
            });
    }



	function getCookie(name) {
		var value = "; " + document.cookie;
		var parts = value.split("; " + name + "=");
		if (parts.length == 2) return parts.pop().split(";").shift();
	}

    function mostrarInfoEquipo() {
    // Obtener el nombre del equipo desde el span
    const nombreEquipo = document.getElementById('userTeam').textContent;
    console.log(document.getElementById('userTeam').textContent);
    // URL de la API con el nombre del equipo como parámetro
    const apiUrl = `https://www.thesportsdb.com/api/v1/json/3/searchteams.php?t=${nombreEquipo}`;

    // Realizar la solicitud a la API
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            // Obtener la información del equipo
            const equipo = data.teams[0];

            // Crear el HTML para mostrar la información del equipo
            const infoEquipoHTML = `
                <h2>${equipo.strTeam}</h2>
                <p>Estadio: ${equipo.strStadium}</p>
                <p>País: ${equipo.strCountry}</p>
                <p>Web: <a href="${equipo.strWebsite}" target="_blank">${equipo.strWebsite}</a></p>
                <p>Descripción: ${equipo.strDescriptionEN}</p>
                <img src="${equipo.strTeamBadge}" alt="${equipo.strTeam}" width="100">
            `;

            // Mostrar la información del equipo en el div "info-equipo"
            document.getElementById('info-equipo').innerHTML = infoEquipoHTML;
        })
        .catch(error => {
            console.error('Error al cargar la información del equipo:', error);
        });
}

// Llamar a la función para mostrar la información del equipo cuando la página esté lista

</script>

<body class="cuerpo">

    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Sistema Deportivo</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
                    <!-- Cerrar Sesión -->
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="cerrarSesion();"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Fin de la barra de navegación -->

    <!-- Contenido principal -->
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8 text-center">
                <h1 class="text-white">¡Hola: <span id="userName"></span>! </h1>
                <h2 class="display-4 text-white mb-4">Bienvenido a nuestro sistema de gestión deportivo</h2>
            </div>

            <div class="col-md-8 text-center" >
                <div id="userInfo">
                    <h2>Información del Usuario</h2>
                    <p>ID de Usuario: <span id="userId"></span></p>
                    <p>Nombre de Usuario: <span id="userName"></span></p>
                    <p>Nivel de Usuario: <span id="userLevel"></span></p>
                    <p>Preferencia de Equipo: <span id="userTeam"></span></p>
                </div>
            </div>

        </div>
        <!-- Fin de la imagen -->
    </div>

    <div class="container mt-2">
        <h2>Informacion Equipo Preferencia</h2>
        <div id="info-equipo"></div>

    </div>
    <!-- Fin del contenido principal -->

    <!-- Script para cerrar sesión -->
    <script>
        function cerrarSesion() {
            document.cookie = "idUsuario=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            window.location.href = 'index.html';
        }
    </script>

</body>

</html>
